<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. Introducing Spatial Availability • AccessPack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. Introducing Spatial Availability">
<meta property="og:description" content="AccessPack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AccessPack</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Empirical-Example-TTS-2016.html">2. Empirical Example: TTS 2016</a>
    </li>
    <li>
      <a href="../articles/Introducing-Spatial-Availability.html">1. Introducing Spatial Availability</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. Introducing Spatial Availability</h1>
            
      
      
      <div class="hidden name"><code>Introducing-Spatial-Availability.Rmd</code></div>

    </div>

    
    
<p>Accessibility analysis is widely employed in transportation, geography, public health, and many other areas. It is a relatively simple concept whose appeal derives from combining the spatial distribution of opportunities and the cost of reaching them. Recent works have aimed at making accessibility easier to interpret. This vignette introduces the concept of spatial <em>availability</em>, a form of singly-constrained accessibility that preserves the number of opportunities available, and therefore leads to more interpretable results.</p>
<div class="section level2">
<h2 id="accessibility-analysis">Accessibility Analysis<a class="anchor" aria-label="anchor" href="#accessibility-analysis"></a>
</h2>
<p>Most accessibility measures (excluding utility-based measures) are derived from the gravity model, and are known as <em>gravity-based</em> accessibility. Briefly, consider the following conventional accessibility measure <span class="math inline">\(A_i\)</span> : <span class="math display">\[
A_i = \sum_{j=1}^JW_jf(c_{ij})
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(i\)</span> is a set of origin locations.</li>
<li>
<span class="math inline">\(j\)</span> is a set of destination locations.</li>
<li>
<span class="math inline">\(W_j\)</span> is the number of opportunities at location <span class="math inline">\(j\)</span>. These are opportunities for activity and add some sort of <em>supply</em> to the area;</li>
<li>
<span class="math inline">\(c_{ij}\)</span> is a measure of the cost of moving between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>
</li>
<li>
<span class="math inline">\(f(\cdot)\)</span> is an impedance (or distance-decay) function (a monotonically non-increasing or decreasing function of <span class="math inline">\(c_{ij}\)</span>).</li>
</ul>
<p>The accessibility value <span class="math inline">\(A_i\)</span>, it can be seen, is the weighted sum of opportunities that can be reached from location <span class="math inline">\(i\)</span>, given the cost of travel <span class="math inline">\(c_{ij}\)</span> and an impedance function. Summing the opportunities in the neighborhood of <span class="math inline">\(i\)</span> (the neighborhood is defined by the impedance function) estimates of the total number of opportunities that can be reached from <span class="math inline">\(i\)</span> at a certain cost. Depending on the impedance function, the measure could be cumulative opportunities (if <span class="math inline">\(f(\cdot)\)</span> is a binary or indicator function) or a more traditional gravity measure, for instance with a Gaussian impedance function or an inverse cost impedance function.</p>
<p>We use a toy example to introduce the concept of <em>spatial availability</em>, and we will use a conventional accessibility measure for comparison. In this way, we aim to show their differences and discuss how spatial availability improves interpretability in the analysis of spatially dispersed opportunities.</p>
<div class="section level3">
<h3 id="numerical-toy-example">Numerical Toy Example<a class="anchor" aria-label="anchor" href="#numerical-toy-example"></a>
</h3>
<p>In this section we present a simple numerical example.</p>
<p>Begin by loading the packages needed for the example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AccessPack</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></code></pre></div>
<p>The setup for the example is a simple system with three employment centers and nine population centers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">type</span>,
              shape <span class="op">=</span> <span class="va">type</span>,
              size <span class="op">=</span> <span class="va">number</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">id_short</span><span class="op">)</span>,
               size <span class="op">=</span> <span class="fl">3</span>,
               nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">600</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, 
                                        color <span class="op">=</span> <span class="st">"black"</span>, 
                                        fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>This is the distribution of jobs and population:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_sim_zones</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:left;">
id_short
</th>
<th style="text-align:right;">
number
</th>
<th style="text-align:left;">
type
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Employment Center 1
</td>
<td style="text-align:left;">
E1
</td>
<td style="text-align:right;">
750
</td>
<td style="text-align:left;">
jobs
</td>
</tr>
<tr>
<td style="text-align:left;">
Employment Center 2
</td>
<td style="text-align:left;">
E2
</td>
<td style="text-align:right;">
2250
</td>
<td style="text-align:left;">
jobs
</td>
</tr>
<tr>
<td style="text-align:left;">
Employment Center 3
</td>
<td style="text-align:left;">
E3
</td>
<td style="text-align:right;">
1500
</td>
<td style="text-align:left;">
jobs
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 1
</td>
<td style="text-align:left;">
P1
</td>
<td style="text-align:right;">
260
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 2
</td>
<td style="text-align:left;">
P2
</td>
<td style="text-align:right;">
255
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 3
</td>
<td style="text-align:left;">
P3
</td>
<td style="text-align:right;">
510
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 4
</td>
<td style="text-align:left;">
P4
</td>
<td style="text-align:right;">
495
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 5
</td>
<td style="text-align:left;">
P5
</td>
<td style="text-align:right;">
1020
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 6
</td>
<td style="text-align:left;">
P6
</td>
<td style="text-align:right;">
490
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 7
</td>
<td style="text-align:left;">
P7
</td>
<td style="text-align:right;">
980
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 8
</td>
<td style="text-align:left;">
P8
</td>
<td style="text-align:right;">
260
</td>
<td style="text-align:left;">
population
</td>
</tr>
<tr>
<td style="text-align:left;">
Population 9
</td>
<td style="text-align:left;">
P9
</td>
<td style="text-align:right;">
255
</td>
<td style="text-align:left;">
population
</td>
</tr>
</tbody>
</table>
<p>The accessibility to employment of each of the population centers can be calculated using the expression above for <span class="math inline">\(A_i\)</span>. As noted, this yields the number of jobs (opportunities) that are accessible (i.e., can be reached) from each population center, given the cost.</p>
<p>In this example we use the straight line distance between the population and jobs for <span class="math inline">\(c_{ij}\)</span>, and a negative exponential function with <span class="math inline">\(\beta = 0.0015\)</span>. The impedance function is calculated as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.0015</span>
<span class="va">toy_od_table</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span> <span class="op">*</span> <span class="va">distance</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Calculate the accessibility:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># using the origin-destination table (OD) of all origin to destination trips; filter in only jobs which are mean distance or less away from a population center and sum number of jobs available in each origin (population center)</span>
<span class="va">c_accessibility</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>A_ij <span class="op">=</span> <span class="va">f</span> <span class="op">*</span> <span class="va">Jobs</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Origin</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>A_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">A_ij</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Join the results to the geography of the system:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#pass conventional accessibility calculation into the spatial object (toy_sim_zones)</span>
<span class="va">toy_sim_zones_access</span>  <span class="op">&lt;-</span> <span class="va">toy_sim_zones</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">c_accessibility</span>, 
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"Origin"</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p>Plot the accessibility to employment in the example;</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_c_access_jobs_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">A_i</span>,
              size <span class="op">=</span> <span class="va">A_i</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">A_i</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">number</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"OrRd"</span>,
                        direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, 
                                        color <span class="op">=</span> <span class="st">"black"</span>, 
                                        fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">toy_c_access_jobs_plot</span> </code></pre></div>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>The plot shows the three employment centers (black circles), with the size of the symbol in proportion to the number of jobs there. We also see nine population centers (triangles), where the size of the symbol is proportional to the accessibility to jobs. At a quick glance:</p>
<ul>
<li><p>Population centers (triangles) in the middle of the map are relatively close to all three employment centers and thus have the highest levels of job accessibility. Population center P5 is relatively central and close to all employment centers, and it is the closest population to the second largest employment center in the region. Unsurprisingly, this population center has the highest accessibility 680.6373657);</p></li>
<li><p>Population centers (triangles) near the left edge of the map (only in proximity to the small employment center) have the lowest levels of job accessibility. Population center P1 is quite peripheral and the closest employment center is also the smallest one. Consequently, it has the lowest accessibility with <span class="math inline">\(A_i=\)</span> 17.1231653);</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="what-are-the-issues">What are the Issues?<a class="anchor" aria-label="anchor" href="#what-are-the-issues"></a>
</h2>
<p>Accessibility measures such as that illustrated above are excellent indicators of the intersection between urban structure and transportation infrastructure. However, beyond enabling comparisons of cardinality (e.g., P5 has higher accessibility than P1, which although low is still better than zero) they are not highly interpretable on their own.</p>
<p>First, the “total accessibility” in the region is not a meaningful quantity since it is not constrained to resemble, let alone match the number of opportunities available in a region. Further, this quantity, if calculated, depends on the number of origins: since every additional origin in the analysis makes at least one and possibly more opportunities at destinations to be multiple-counted, the “total accessibility” is vulnerable to the modifiable areal unit problem.</p>
<p>Secondly, it is unclear what the highest and lowest levels of accessibility in the region actually represent. For example, an individual at P5 in the example has accessibility to 680.6373657 jobs. But since this is also a large population center, there is potentially large competition for those accessible jobs. In other words, the value of <span class="math inline">\(A_i\)</span> is not sensitive to the size of population at the origin seeking the opportunity (in this case jobs), let alone the population at other locations. This unfortunately limits the interpretability of the measure. Floating catchment areas purport to account for competition/congestion effects, but as discussed by Paez, Higgins, and Vivona <a href="https://doi.org/10.1371/journal.pone.0218773" class="external-link">(2019)</a>, they are vulnerable to inflation/deflation issues, which makes them prone to bias unless corrected.</p>
<p>As an alternative, we propose a measure of <em>spatial availability</em>.</p>
<p>Spatial availability is an appropriate framework for <em>indivisible</em> opportunities. These are opportunities that, once they have been taken by someone, are no longer available to other members of the population. Examples of indivisible opportunities include jobs (when a person takes up a job, the same job cannot be taken by someone else) and seats at schools (once a student takes a seat at a school, that particular opportunity is no longer there for another student). From a different perspective, employers may see workers as opportunities, so when a worker takes a job, this particular individual is no longer in the available pool of candidates for hiring. As we will show, spatial availability is a singly-constrained measure of accessibility.</p>
<p>In the following sections we will describe and illustrate this new measure using simple numerical examples. First, we will describe the measure. Second, we will calculate the spatial availability of jobs from the perspective of the population. Then, we will calculate the spatial availability of workers from the perspective of employers. Next, we will illustrate how to calculate the spatial availability with catchment restrictions. Finally, we will compare conventional accessibility estimates to the proposed measure of spatial availability.</p>
</div>
<div class="section level2">
<h2 id="spatial-availability">Spatial Availability<a class="anchor" aria-label="anchor" href="#spatial-availability"></a>
</h2>
<p>As recent research on accessibility shows (see for instance Paez, Higgins, Vivona, <a href="https://doi.org/10.1371/journal.pone.0218773" class="external-link">2019</a> and Allen and Farber <a href="https://doi.org/10.1111/gean.12188" class="external-link">(2020)</a>), accounting for competitive access in a meaningful way requires the proportional allocations of quantities in the accessibility calculations, or their normalization. At issue is the fact that that multiple-counting is commonplace when calculating conventional accessibility <span class="math inline">\(A_i\)</span> for <span class="math inline">\(i=1,\cdots,n\)</span>. This is easy to see once we realize that every opportunity enters the weighted sum once for every origin <span class="math inline">\(i\)</span> that can reach it. This has the unfortunate effect of obscuring the interpretability of <span class="math inline">\(A_i\)</span> and fails to answer for a individual at a specific population center the question: “many jobs are accessible, but the same jobs are also accessible to my (possibly) numerous neighbors…what does high accessibility actually mean to me?”</p>
<p>In the spatial availability framework proposed, and in line with the gravity tradition, we distinguish between opportunities at a destination and demand for opportunities at the origin. To explain the analytical framework, the example of accessibility to employment is illustrative, with “population” in the role of demand and “jobs” in the role of opportunities.</p>
<p>We begin with allocation based on demand (the number of individuals in the population in the labor market who “demand” employment). Consider an employment center <span class="math inline">\(j\)</span> with <span class="math inline">\(W_j^r\)</span> jobs of type <span class="math inline">\(r\)</span>. In the general case where there are <span class="math inline">\(K\)</span> population centers in the region, the following factor can be defined to allocate the jobs proportionally based on the size of the population at each center: <span class="math display">\[
f^p_{ij} = \frac{P_{i\in r}^\alpha}{\sum_{k=1}^K P_{k\in r}^\alpha}
\]</span> where <span class="math inline">\(f^p_{ij}\)</span> is a factor that proportionally allocates a share of the jobs at <span class="math inline">\(j\)</span> to population center <span class="math inline">\(i\)</span>. On the right hand side of the equation, <span class="math inline">\(P_{k\in r}\)</span> is the population at location <span class="math inline">\(k\)</span> that is eligible for jobs of type <span class="math inline">\(r\)</span> (maybe those with a certain level of training, or in a designated age group). Here we add an empirical parameter <span class="math inline">\(\alpha\)</span> that can be used to modulate the effect of size in the calculations (i.e., if <span class="math inline">\(\alpha &lt;1\)</span> employment centers draw more rapidly from small centers than from large centers, and when <span class="math inline">\(\alpha&gt;1\)</span> employment centers draw more rapidly from large population centers). The summation in the bottom is over <span class="math inline">\(k=1,\cdots,K\)</span>, the number of population centers in the region. The factors <span class="math inline">\(f_{kj}^p\)</span> satisfy the property that <span class="math inline">\(\sum_k^{K} f^p_{kj} = 1\)</span>.</p>
<p>The share of jobs at <span class="math inline">\(j\)</span> allocated to (i.e., available to) each population center is: <span class="math display">\[
V_{kj} = W_jf^p_{kj}
\]</span> and since <span class="math inline">\(\sum_k^{K} f^p_{kj} = 1\)</span> it follows that: <span class="math display">\[
\sum_{k=1}^K V_{kj} = W_j 
\]</span></p>
<p>In other words, the number of jobs is preserved.</p>
<p>As an example, consider an employment center <span class="math inline">\(j\)</span> in a region with two population centers (say <span class="math inline">\(i\)</span> and <span class="math inline">\(k\)</span>). For simplicity, assume that the all the population in the region is eligible for these jobs, that is, that the entirety of the population is included in the set <span class="math inline">\(r\)</span>. The allocation factors for the jobs at <span class="math inline">\(j\)</span> would be: <span class="math display">\[
\begin{array}{l}\
f^p_{ij} = \frac{P_i ^\alpha}{P_i^\alpha + P_k^\alpha}\\
f^p_{kj} = \frac{P_k^\alpha}{P_i^\alpha + P_k^\alpha}\\
\end{array}
\]</span></p>
<p>Suppose that there are three hundred jobs in the employment center (<span class="math inline">\(W_j = 300\)</span>), and that the populations are <span class="math inline">\(P_j=240\)</span> and <span class="math inline">\(P_k=120\)</span>. The jobs are allocated as follows (assuming that <span class="math inline">\(\alpha=1\)</span>): <span class="math display">\[
\begin{array}{l}\
V_{ij} = W_j\frac{P_i^\alpha}{P_i^\alpha + P_k^\alpha} = 300\frac{240}{240 + 120} = 300\frac{240}{360} = 200\\
V_{kj} = W_j\frac{P_k^\alpha}{P_i^\alpha + P_k^\alpha} = 300\frac{120}{240 + 120} = 300\frac{120}{360} = 100 \\
\end{array}
\]</span> It can be seen that proportionally more jobs are allocated to the bigger center and also that the total number of jobs is preserved (<span class="math inline">\(\sum_{k=1}^K W_{kj} = W_j\)</span>).</p>
<p>The factors above account for the total number of opportunities at the destination (i.e., the number of jobs at the employment center), but they do not account for their location relative to the population centers. The proportional allocation procedure above is insensitive to how far population center <span class="math inline">\(i\)</span> is from employment center <span class="math inline">\(j\)</span>. To account for this effect we define a second set of allocation factors based on distance to the employment centers. These are defined as: <span class="math display">\[
f^c_{ij} = \frac{f(c_{ij})}{\sum_{k=1}^K f(c_{kj})}
\]</span> where <span class="math inline">\(c_{ij}\)</span> is the cost (e.g., the distance, travel time, etc.) to employment center <span class="math inline">\(j\)</span> from population center <span class="math inline">\(i\)</span>, and <span class="math inline">\(f(\cdot)\)</span> is an impedance function, that is a monotonically decreasing function of <span class="math inline">\(c_{kj}\)</span>. The idea is that proportionally more jobs are allocated to closer locations. Assume that the impedance function is a negative exponential function as follows, and assume that <span class="math inline">\(\beta\)</span> (which modulates the steepness of the impedance effect and is an empirical parameter) is one: <span class="math display">\[
f(c_{ij}) = \exp(-\beta c_{ij})
\]</span> Continuing the example, suppose that the distance from population center <span class="math inline">\(i\)</span> to employment center <span class="math inline">\(j\)</span> is 0.6 km, and the distance from population center <span class="math inline">\(k\)</span> to employment center <span class="math inline">\(j\)</span> is 0.3 km. Being closer, we would expect more jobs to be allocated to the population of <span class="math inline">\(i\)</span>. The jobs would be sorted as follows: <span class="math display">\[
\begin{array}{l}\
f^c_{ij} = \frac{\exp(-\beta D_{ij})}{\exp(-\beta D_{ij}) + \exp(-\beta D_{kj})}\\
f^c_{kj} = \frac{\exp(-\beta D_{kj})}{\exp(-\beta D_{ij}) + \exp(-\beta D_{kj})}\\
\end{array}
\]</span></p>
<p>Numerically, the jobs allocation is: <span class="math display">\[
\begin{array}{l}\
V^d_{ij} = W_j\frac{\exp(-D_{ij})}{\exp(-D_{ij}) + \exp(-D_{kj})} = 300\frac{\exp(-0.6)}{\exp(-0.6) + \exp(-0.3)} = 3\times 0.426 = 127.8\\
V^d_{kj} = W_j\frac{\exp(-D_{kj})}{\exp(-D_{ij}) + \exp(-D_{kj})} = 300\frac{\exp(-0.3)}{\exp(-0.6) + \exp(-0.3)} = 3\times  0.574 = 172.2\\
\end{array}
\]</span> A larger share of jobs is allocated to the population center that is closest. As before, the sum of jobs allocated to the population centers matches the total number of jobs available.</p>
<p>We can combine the proportional allocation factors by population and distance as follows: <span class="math display">\[
V_{ij} = W_i\frac{f^p_{ij} \cdot f^c_{ij}}{\sum_{k=1}^K f^p_{kj} \cdot f^c_{kj}}
\]</span></p>
<p>In the example: <span class="math display">\[
\begin{array}{l}\
V_{ij} = W_j\cdot \frac{f^o_{ij} \cdot f^c_{ij}}{f^o_{ij} \cdot f^c_{ij} + f^o_{kj} \cdot f^c_{kj}} = 300 \frac{\big(\frac{2}{3} \big) \big(0.426 \big)}{\big(\frac{2}{3} \big) \big(0.426 \big) + \big(\frac{1}{3} \big) \big(0.574 \big)} = \big(300 \big)\big(\frac{0.284}{0.475} \big)= 179.4\\
V_{kj} = W_j\cdot \frac{f^o_{kj} \cdot f^c_{kj}}{f^o_{ij} \cdot f^c_{ij} + f^o_{ik} \cdot f^c_{ik}} = 300 \frac{\big(\frac{1}{3} \big) \big(0.574 \big)}{\big(\frac{2}{3} \big) \big(0.426 \big) + \big(\frac{1}{3} \big) \big(0.574 \big)}  = \big(300 \big)\big(\frac{0.191}{0.475} \big)= 120.6 \\
\end{array}
\]</span> Notice how fewer jobs are allocated to population center <span class="math inline">\(i\)</span> compared to the allocation by population only, to account for the higher cost of reaching the employment center. On the other hand, distance alone allocated more jobs to the closest population center (i.e., <span class="math inline">\(k\)</span>), but since it is smaller, it also get a smaller share of the jobs overall. Again, the sum of jobs at employment center <span class="math inline">\(j\)</span> that are allocated to population centers <span class="math inline">\(i\)</span> and <span class="math inline">\(k\)</span> simultaneously based on <em>population-</em> and <em>distance-</em> based allocation is preserved (i.e., <span class="math inline">\(W_{ij} + W_{kj} = W_j\)</span>).</p>
<p>Availability is simply the sum of the above by origin: <span class="math display">\[
V_i = \sum_{j=1}^J V_{ij}
\]</span> This quantity represents opportunities (e.g., jobs) that can be reached from <span class="math inline">\(i\)</span> (i.e., they are accessible), and that are <em>not</em> allocated to a competitor: therefore the weighted sum of available opportunities. Compare <span class="math inline">\(V_i\)</span> to the singly-constrained gravity model (see Wilson <a href="https://doi.org/10.1068/a030001" class="external-link">(1971)</a>). In essence, <span class="math inline">\(V_i\)</span> is the result of constraining <span class="math inline">\(A_i\)</span> to match one of the marginals in the origin-destination table, the known total of opportunities.</p>
<p>Since the sum of opportunities is preserved in the procedures above, it is possible to calculate a highly interpretable measure of spatial availability per capita (call it lower-case <span class="math inline">\(v_i\)</span>) as follows: <span class="math display">\[
v_i = \frac{V_i}{P_i}
\]</span></p>
<p>In the example above: <span class="math display">\[
\begin{array}{l}\
v_{ij} = \frac{V_{ij}}{P_i} =  \frac{179.4}{240}\\
v_{kj} =  \frac{V_{ik}}{P_k} =  \frac{120.6}{120}\\
\end{array}
\]</span> Less competition (<span class="math inline">\(P_k\)</span> is the smallest population center in the region) and being closer to the jobs clearly works in favor of individuals at <span class="math inline">\(k\)</span>. Where the overall ratio of jobs to population in the region is <span class="math inline">\(300/(240 + 120)=\)</span> 0.83, the spatially available jobs per capita at <span class="math inline">\(k\)</span> is closer to unity.</p>
<p>In the following sections we use the same numerical example presented above to illustrate how availability <span class="math inline">\(V_i\)</span> is calculated. We conclude by contrasting the two measures in the final section.</p>
<div class="section level3">
<h3 id="st-use-case-available-jobs-for-the-working-population">1st Use Case: Available Jobs for The Working Population<a class="anchor" aria-label="anchor" href="#st-use-case-available-jobs-for-the-working-population"></a>
</h3>
<p>In the following examples we use the same impedance function that was used to illustrate the accessibility calculations in the numerical example. The spatial availability calculations are implemented in the function <code>sp_avail</code>. The inputs are an Origin-Destination table with labels for the origins (<code>o_id</code>), labels for the destinations (<code>d_id</code>), the population (<code>pop)</code> and number of opportunities (<code>opp</code>), an indicator for catchments or other eligibility constraints (<code>r</code>), and a pre-calculated impedance function (<code>f</code>). For this example, we assume that there are no catchment restrictions by setting <code>r</code> to 1.</p>
<p>The value of the function (its output) is a vector with <span class="math inline">\(V_ij\)</span> given the inputs, that is, the opportunities available to <span class="math inline">\(i\)</span> from <span class="math inline">\(j\)</span>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_od_table</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>catch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># No catchment restrictions, all members of the population are eligible for the opportunities</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>V_ij <span class="op">=</span> <span class="fu"><a href="../reference/sp_avail.html">sp_avail</a></span><span class="op">(</span><span class="va">.</span>, 
                         o_id <span class="op">=</span> <span class="va">Origin</span>, 
                         d_id <span class="op">=</span> <span class="va">Destination</span>, 
                         pop <span class="op">=</span> <span class="va">Population</span>, 
                         opp <span class="op">=</span> <span class="va">Jobs</span>,
                         r <span class="op">=</span> <span class="va">catch</span>,
                         f <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>After calculating that spatial availability, we can verify that the sum of all available jobs is consistent with the total number of jobs in the region:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">toy_od_table</span><span class="op">$</span><span class="va">V_ij</span><span class="op">)</span>
<span class="co">#&gt; [1] 4500</span>

<span class="va">toy_sim_zones</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 4500</span></code></pre></div>
<p>As seen, the total number of jobs is preserved.</p>
<p>Next we aggregate the jobs spatially available by origin-destination pair to obtain <span class="math inline">\(V_i\)</span>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">availability</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Origin</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>V_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">V_ij</span><span class="op">)</span><span class="op">)</span>
<span class="va">availability</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 x 2</span></span>
<span class="co">#&gt;   Origin          V_i</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Population 1   67.0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Population 2  414. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Population 3  336. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Population 4  745. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Population 5 <span style="text-decoration: underline;">2</span>081. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Population 6  270. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Population 7  256. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Population 8  316. </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">9</span> Population 9   14.9</span></code></pre></div>
<p>To visualize the outcome we proceed to join the availability to the zones in the example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_sim_zones_access</span> <span class="op">&lt;-</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">availability</span>, 
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"Origin"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The following plot shows the estimates of spatial availability:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_avail_jobs_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">V_i</span>,
              size <span class="op">=</span> <span class="va">V_i</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">V_i</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">number</span>,
              shape <span class="op">=</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"OrRd"</span>,
                        direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, 
                                        color <span class="op">=</span> <span class="st">"black"</span>, 
                                        fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">toy_avail_jobs_plot</span></code></pre></div>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<p>We see that population center 5 has the highest level of spatial availability, due to being a large population center that is moreover relatively close to jobs. To improve the interpretability of this measure, we first note that the regional measure of jobs per capita is 0.994. We then calculate the spatially available jobs per person at each population center:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_sim_zones_access</span> <span class="op">&lt;-</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>v_i <span class="op">=</span> <span class="va">V_i</span><span class="op">/</span><span class="va">number</span><span class="op">)</span>

<span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">v_i</span><span class="op">)</span>
<span class="co">#&gt;             id        v_i</span>
<span class="co">#&gt; 1 Population 1 0.25787932</span>
<span class="co">#&gt; 2 Population 2 1.62445872</span>
<span class="co">#&gt; 3 Population 3 0.65947335</span>
<span class="co">#&gt; 4 Population 4 1.50495734</span>
<span class="co">#&gt; 5 Population 5 2.03989862</span>
<span class="co">#&gt; 6 Population 6 0.55082935</span>
<span class="co">#&gt; 7 Population 7 0.26164373</span>
<span class="co">#&gt; 8 Population 8 1.21352615</span>
<span class="co">#&gt; 9 Population 9 0.05842544</span></code></pre></div>
<p>Plot the spatial availability per person:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_avail_jobs_person_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">v_i</span>,
              size <span class="op">=</span> <span class="va">v_i</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">v_i</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, 
                                        color <span class="op">=</span> <span class="st">"black"</span>, 
                                        fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">toy_avail_jobs_person_plot</span></code></pre></div>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p>Some population centers have almost two jobs available per person (compared to the overall regional value of approximately one job per capita), while others have less than one job available per person. This does not mean that people are not taking some of the jobs. It means that controlling for the cost of reaching jobs, they are worse off than those with more jobs spatially available.</p>
</div>
<div class="section level3">
<h3 id="nd-use-case-available-workers-for-employment-centers">2nd Use Case: Available Workers for Employment Centers<a class="anchor" aria-label="anchor" href="#nd-use-case-available-workers-for-employment-centers"></a>
</h3>
<p>We can also examine the pool of workers available to each employment center by considering the workers as the opportunities and the jobs as the population.</p>
<p>Calculate the proportional allocation of jobs to population (referred to as <span class="math inline">\(W_ji\)</span>):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_od_table</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>catch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>W_ji <span class="op">=</span> <span class="fu"><a href="../reference/sp_avail.html">sp_avail</a></span><span class="op">(</span><span class="va">.</span>, 
                         o_id <span class="op">=</span> <span class="va">Destination</span>, 
                         d_id <span class="op">=</span> <span class="va">Origin</span>, 
                         pop <span class="op">=</span> <span class="va">Jobs</span>, 
                         opp <span class="op">=</span> <span class="va">Population</span>,
                         r <span class="op">=</span> <span class="va">catch</span>,
                         f <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Verify that the sum of all population allocated is consistent with the total number of population:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">toy_od_table</span><span class="op">$</span><span class="va">W_ji</span><span class="op">)</span>
<span class="co">#&gt; [1] 4525</span>

<span class="va">toy_sim_zones</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 4525</span></code></pre></div>
<p>The total population is preserved.</p>
<p>Aggregate available workers by employment center:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">availability</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Destination</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>W_j <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">W_ji</span><span class="op">)</span><span class="op">)</span>
<span class="va">availability</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 x 2</span></span>
<span class="co">#&gt;   Destination           W_j</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Employment Center 1  610.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Employment Center 2 <span style="text-decoration: underline;">1</span>710.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Employment Center 3 <span style="text-decoration: underline;">2</span>205.</span></code></pre></div>
<p>Join the availability to the toy_sim_zones_access:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_sim_zones_access</span> <span class="op">&lt;-</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">availability</span>, 
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"Destination"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Plot the availability estimates:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_avail_workers_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">W_j</span>,
              size <span class="op">=</span> <span class="va">W_j</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">W_j</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">number</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"OrRd"</span>,
                        direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, 
                                        color <span class="op">=</span> <span class="st">"black"</span>, 
                                        fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">toy_avail_workers_plot</span></code></pre></div>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
<p>Since the population is preserved, we can calculate the available workers per job:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_sim_zones_access</span> <span class="op">&lt;-</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>w_j <span class="op">=</span> <span class="va">W_j</span><span class="op">/</span><span class="va">number</span><span class="op">)</span>

<span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">w_j</span><span class="op">)</span>
<span class="co">#&gt;                    id       w_j</span>
<span class="co">#&gt; 1 Employment Center 1 0.8137264</span>
<span class="co">#&gt; 2 Employment Center 2 0.7597858</span>
<span class="co">#&gt; 3 Employment Center 3 1.4701247</span></code></pre></div>
<p>Plot the spatial availability of workers per job:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_avail_workers_job_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">w_j</span>,
              size <span class="op">=</span> <span class="va">w_j</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"jobs"</span><span class="op">)</span>,
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">w_j</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span>,
          shape <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, 
                                        color <span class="op">=</span> <span class="st">"black"</span>, 
                                        fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="va">toy_avail_workers_job_plot</span></code></pre></div>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="rd-use-case-available-jobs-for-specialized-working-populations">3rd Use Case: Available Jobs for Specialized Working Populations<a class="anchor" aria-label="anchor" href="#rd-use-case-available-jobs-for-specialized-working-populations"></a>
</h3>
<p>In this section we introduce catchment/eligibility constraints. Due to differences in educational achievement among the population, the jobs in Employment Center 1 can only be taken by individuals in population centers 1 and 2. Jobs in Employment Center 2 can be taken by individuals in population centers 3, 4, 5, 7, and 8. Lastly, jobs in Employment Center 3 require qualifications available only among individuals in population centers 5, 6, 8, and 9. See figure below.</p>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
<p>Calculate the proportional allocation of opportunities but now with catchment constraint (referred to as <span class="math inline">\(V_ij_r\)</span>):</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_od_table</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>V_ij_r <span class="op">=</span> <span class="fu"><a href="../reference/sp_avail.html">sp_avail</a></span><span class="op">(</span><span class="va">.</span>,
                           o_id <span class="op">=</span> <span class="va">Origin</span>,
                           d_id <span class="op">=</span> <span class="va">Destination</span>,
                           pop <span class="op">=</span> <span class="va">Population</span>,
                           opp <span class="op">=</span> <span class="va">Jobs</span>,
                           r <span class="op">=</span> <span class="va">catchments</span>,
                           f <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Verify that the sum of all jobs allocated is consistent with the total number of jobs:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">toy_od_table</span><span class="op">$</span><span class="va">V_ij_r</span><span class="op">)</span>
<span class="co">#&gt; [1] 4500</span>

<span class="va">sum_jobs</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Destination</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Jobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Jobs</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sum_jobs</span><span class="op">$</span><span class="va">Jobs</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; [1] 4500</span></code></pre></div>
<p>The total number of jobs is preserved.</p>
<p>Repeat the availability calculation:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">availability</span> <span class="op">&lt;-</span> <span class="va">toy_od_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Origin</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>V_i_r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">V_ij_r</span><span class="op">)</span><span class="op">)</span>
<span class="va">availability</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 x 2</span></span>
<span class="co">#&gt;   Origin         V_i_r</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Population 1  104.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Population 2  646.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Population 3  303.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Population 4  527.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Population 5 <span style="text-decoration: underline;">2</span>173.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Population 6  257.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Population 7  161.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Population 8  322.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">9</span> Population 9    7.52</span></code></pre></div>
<p>Join the availability to the toy_sim_zones_access:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_sim_zones_access</span> <span class="op">&lt;-</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">availability</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span> <span class="op">=</span> <span class="st">"Origin"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Plot the availability estimates: <img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-31-1.png" width="576"></p>
<p>Available jobs per person with catchment/eligibility conditions:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_sim_zones_access</span> <span class="op">&lt;-</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>v_i_r <span class="op">=</span> <span class="va">V_i_r</span><span class="op">/</span><span class="va">number</span><span class="op">)</span></code></pre></div>
<p>The next plot shows the availability per person without and with catchment restrictions: <img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-33-1.png" width="576"></p>
<p>We can see that when there are catchment restrictions population center 2, despite being relatively peripheral, has higher spatial availability due to spatial specialization. With catchments, the spatial availability of jobs declines from the perspective of population center 4: the population here has skills required for jobs at a small employment center, where they face substantial competition from other population centers.</p>
</div>
</div>
<div class="section level2">
<h2 id="comparing-accessibility-and-spatial-availability">Comparing Accessibility and Spatial Availability<a class="anchor" aria-label="anchor" href="#comparing-accessibility-and-spatial-availability"></a>
</h2>
<p>Below we compare accessibility and the first case of spatial availability illustrated above. To facilitate the comparison, we index the measures so that the lowest value corresponds to an index of 100:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indexed_measures</span> <span class="op">&lt;-</span> <span class="va">toy_sim_zones_access</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"population"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>A_indexed <span class="op">=</span> <span class="va">A_i</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">A_i</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>,
         V_indexed <span class="op">=</span> <span class="va">V_i</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">V_i</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">id_short</span>, <span class="va">A_indexed</span>, <span class="va">V_indexed</span><span class="op">)</span></code></pre></div>
<p><img src="introducing-spatial-availability_files/figure-html/unnamed-chunk-35-1.png" width="576"> The figure suggests that high accessibility does not necessarily mean high availability.</p>
<div class="section level3">
<h3 id="how-are-the-these-measures-different">How are the these measures different?<a class="anchor" aria-label="anchor" href="#how-are-the-these-measures-different"></a>
</h3>
<p>The sum of all spatial availability values is equal to the total number of opportunities within the region. As such, the value for each population center reflects how many opportunities are <em>available</em> accounting for the indivisibility of the opportunities. This provides greater interpretability of the results. Comparatively, accessibility values associated with each population centers reflects how many jobs can <em>potentially</em> be reached by each population center; these values are not adjusted proportionally to the number of population (i.e. workers ).</p>
<p>Secondly, spatial availability is not robust to the modifiable unit problem, since the estimates account for the population at the centers. If more population centers are added, the availability adjusts accordingly by allocating opportunities proportionally.</p>
<p>Further, the measure of spatial availability can be a useful way to distinguish between high accessibility/high population centers (which potentially can result in lower availability due to competition), and contrariwise, low accessibility/low population centers, which may enjoy higher availability than the accessibility calculations may suggest. Remote, smaller population centers can be sufficiently accessible and in close proximity to the smaller employment centers; however this “sufficiency” is obscured by accessibility measure by over-inflating the accessibly of population centers which are more central to more (and larger) employment centers. Conventional accessible does not shed light on how sufficiently accessible opportunities are available to the population.</p>
<!--
Conventional accessibly measures attempt to correct for this limitation by ... 
**is a solution to normalize conventional accessibility by population? assuming it is..**
However, ultimately if the global number of opportunities (jobs in our case) is not kept equal the accessibility values assigned to each $i$ will be difficult to interpret and introduce basis. The proposed _spatial availability_ measure addresses this issue.
-->
<p>As a final point, we note that the measure proposed, by producing a concrete and interpretable number of opportunities available, can be meaningfully compared to the total number of opportunities in the region. Likewise for opportunities available per capita. This is an important topic in equity analysis. For instance, considering the two remote small population centers in the top left corner it is evident that for individuals in population center 2, despite facing low nominal accessibility, have a relatively high number of available jobs per capita.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anastasia Soukhov, Antonio Paez.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
