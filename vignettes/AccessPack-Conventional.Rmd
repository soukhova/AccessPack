---
title: "AccessPack-Conventional"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{AccessPack-Conventional}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(AccessPack)
library(tidyverse)
library(ggplot2)
library(sf)
```


### A Preamble on Conventioanl Accessibility

Conventional origin-based accessibility `A_{i}` is defined as the summation of:
$$
A_{i} = \sum_{j} (W_j \cdot f(C_{ij}))
$$
Where,
- `i` is a set of origin locations.
- `j` is a set of destination locations.
- `W_{j}` is a set of weights at each destination location. These are opportunities for activity and add some sort of _supply_ to the area;
- `f(C_{ij})` is broadly defined as the impedance function and is a function of `C_{ij}` which is the cost of travel from `i` to `j`. `C_{ij}`is either or a combination of travel time, distance, monetary cost, internal/external costs, subjective cost (comfort, safety, ease, etc) from origin to destination. This travel cost can be expressed in different functions such as a **binary function** where `f(C_{ij})` is set to 0  if `C_{ij}` is outside some `theta` parameter or is set to 1 if inside the `theta` parameter. For example, accessibility for each origin TAZ `A_{i}` is 0 for all travel-times to destination TAZ greater than 30 minutes (`theta`). 
  -  People are at these origins and they have some sort of _demand_;

We are interested in considering  _supply_ from destinations in `W_{j}` but also considering  _demand_ from origins in the impedance function to define origin-based 'available potential accessibility'. From our perspective, supply and demand should be balanced and proportional; this will add more meaning to this origin-based accessibility measure. But first a simple example.

### 2016 TTS Data

Let's extract the number of jobs, at each destination `j`; this is our `W_{j}`.
Next, let's define our `f(C_{ij})`. In this simple example we will assume that it is just a binary function with a `theta` of 45 minutes; so  `A_{i}` is defined as the number of jobs at j that someone from origin i can access in 45 minutes. As this is a binary function; we're simply filtering out all trips that are over 30 minutes and summing up all the jobs within a destination.

```{r}
access_jobs <- od_ft_tt %>% filter(travel_time <= 45) %>% group_by(Destination) %>% summarise(jobs_i = sum(Persons, na.rm = T))
```

Now, we associate this object to a unique origins object to get `A_{i}` for each origin. I also add average travel time as a check to ensure average times are still under the `theta`.
```{r}
gtha_taz_i <- gtha_taz %>% merge(access_jobs, by.x=c("GTA06"), by.y=c("Destination"), all.x=T) 
```

Plot origin accessibility
```{r}
ggplot() +
  geom_sf(data = gtha_taz_i, 
          aes(fill= jobs_i), color = NA) +
    scale_fill_distiller(palette = "Spectral")
```

### Toy Data

dsd
















